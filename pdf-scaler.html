<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PDF Scaler</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
        }

        h2 {
            margin-bottom: 20px;
        }

        input, button {
            margin: 8px 0;
            padding: 6px;
        }

        button {
            cursor: pointer;
        }

        #status {
            margin-top: 15px;
            font-weight: bold;
        }
    </style>
</head>
<body>

<h2>PDF Scale Tool</h2>

<input type="file" id="pdfInput" multiple accept="application/pdf"><br>

<label>Scale (e.g. 0.75 or 75):</label><br>
<input type="text" id="scaleInput" value="0.75"><br>

<button onclick="scalePDFs()">Scale PDFs</button>

<p id="status"></p>

<!-- PDF-LIB CDN -->
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<script>
async function scalePDFs() {
    const input = document.getElementById('pdfInput');
    const scaleValue = document.getElementById('scaleInput').value.trim();
    const status = document.getElementById('status');

    if (!input.files.length) {
        alert("Please select at least one PDF.");
        return;
    }

    let scale = parseFloat(scaleValue);

    if (scale > 1) {
        scale = scale / 100;
    }

    if (isNaN(scale) || scale <= 0) {
        alert("Invalid scale value.");
        return;
    }

    status.innerText = "Processing...";

    for (let file of input.files) {
        const arrayBuffer = await file.arrayBuffer();
        const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
        const newPdf = await PDFLib.PDFDocument.create();

        const pages = await newPdf.copyPages(pdfDoc, pdfDoc.getPageIndices());

        for (let page of pages) {
            const { width, height } = page.getSize();

            const verticalShift = height - (height * scale);

            const embeddedPage = await newPdf.embedPage(page);
            const newPage = newPdf.addPage([width, height]);

            newPage.drawPage(embeddedPage, {
                x: 0,
                y: verticalShift,
                xScale: scale,
                yScale: scale,
            });
        }

        const pdfBytes = await newPdf.save();

        const baseName = file.name.replace(".pdf", "");
        const outputName = `${baseName} - Scaled to ${Math.round(scale * 100)} percent.pdf`;

        downloadFile(pdfBytes, outputName);
    }

    status.innerText = "Done!";
}

function downloadFile(bytes, filename) {
    const blob = new Blob([bytes], { type: "application/pdf" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = filename;
    link.click();
}
</script>

</body>
</html>
